<!DOCTYPE html>
<html>

<head>
  <title>小Q 晚多少？</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assets/bootstrap.min.css">
  <script src="assets/chart.js"></script>
</head>

<body>
  <div class="container">
    <main>
      <div class="py-5 text-center">
        <img src="assets/logo.svg" alt="" class="d-block mx-auto mb-4" width="72" height="57">
        <h2>Is QQ Late?</h2>
        <p class="lead">Just a simple site for QQ's late history 😀</p>
      </div>
      <div class="row g-5">
        <div class="col-md-9 order-md-last">
          <h4 class="d-flex justify-content-between align-items-center mb-3">Chart</h4>
          <div id="chart"></div>
          
        </div>
        <div class="col-md-3">
          <h4 class="mb-3">Data List</h4>
          <ul class="list-group mb-3" id="table-body">
           
          </ul>
        </div>
      </div>
    </main>

  </div>

  <script src="assets/bootstrap.min.js"></script>
  <script>
    // 通过fetch函数异步读取JSON文件
    fetch('data.json')
      .then((response) => response.json())
      .then((data) => {
        const tableData = data.map((item) => {
          const datetime = new Date(item.datetime);
          const date = datetime.toISOString().split('T')[0]
          const time = datetime.toLocaleTimeString();

          const targetTime = new Date(datetime.getFullYear(), datetime.getMonth(), datetime.getDate(), 9, 0, 0);
          const diffInMinutes = (datetime - targetTime) / 60000;
          return {
            date,
            time,
            // lateMinutes: item.lateMinutes
            lateMinutes: diffInMinutes
          };
        });

        // 生成折线图
        const dates = tableData.map((item) => item.date);
        const lateMinutes = tableData.map((item) => item.lateMinutes);
        const chartOptions = {
          chart: {
            type: 'line',
          },
          series: [
            {
              name: '迟到分钟数',
              data: lateMinutes,
            },
          ],
          xaxis: {
            categories: dates,
          },
        };
        const chart = new ApexCharts(document.querySelector('#chart'), chartOptions);
        chart.render();

        // 生成表格数据

        const tableBody = document.querySelector('#table-body');
        for (let i = 0; i < tableData.length; i++) {
          const row = document.createElement('li');
          row.className = 'list-group-item d-flex justify-content-between';

          const dateSpan = document.createElement('span');
          dateSpan.textContent = tableData[i].date;

          const minutesStrong = document.createElement('strong');
          minutesStrong.textContent = `${tableData[i].lateMinutes} mins`;

          row.appendChild(dateSpan);
          row.appendChild(minutesStrong);
          tableBody.appendChild(row);
        }


      });
  </script>
</body>

</html>